# This script is an edited version of the example found at
# https://git.ligo.org/lscsoft/example-ci-project/blob/python/.gitlab-ci.yml
# Each 0th-indentation level is a job that will be run within GitLab CI
# The only exception are a short list of reserved keywords
#
# https://docs.gitlab.com/ee/ci/yaml/#gitlab-ci-yml

# stages is a reserved keyword that defines job dependencies and
# parallelization. each stage runs in parallel but must complete
# before the next stage begins

stages:
  - test
  #- deploy

# test example on python 3
python-3.7:
  stage: test
  image: python:3.7-stretch
  #before_install:
    # add a latex install for the matplotlib testing
    #- sudo apt-get -qq update && sudo apt-get install -y --no-install-recommends texlive texlive-latex-extra dvipng
  before_script:
    - apt-get -qq update && apt-get install -y --no-install-recommends texlive texlive-latex-extra dvipng
    # Install the dependencies specified in the Pipfile
    - pip install --upgrade pip
    - pip install -r requirements.txt
    - pip install -r hierarchical-requirements.txt
    - pip install -r docs-requirements.txt
    - pip install pytest
  script:
    - python setup.py install

    # run tests
    - pytest

    # Make the documentation
    - cd docs
    - make clean
    - make html

  artifacts:
    paths:
      - docs/_build/html/

#pages:
#  stage: deploy
#  dependencies:
#    - python-3.7
#  script:
#    - mkdir -p public/
#    - mv docs/_build/html/* public/
#    - mv htmlcov/ public/
#    - mv coverage_badge.svg public/
#  artifacts:
#    paths:
#      - public
#  only:
#    - master
